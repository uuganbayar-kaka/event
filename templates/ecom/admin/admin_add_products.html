{% extends 'ecom/admin/admin_base.html' %}
{% load widget_tweaks %}
{% block content %}
<style>
    .nova_formset .add-row{
  font-size: 12px;
  padding:10px;
  color: #35aa47;
  vertical-align: top;
}
.nova_formset .add-row:before{
  font-size: 17px;
  padding-right: 5px;
  content: "\e095";
}
.nova_formset .delete-row{
  padding: 4px;
  font-size: 17px;
  color:#d84a38;
  font-family: Simple-Line-Icons;
  speak: none;
  font-style: normal;
  font-weight: 400;
  font-variant: normal;
  text-transform: none;
  display: inline-block;
  margin-top: 1px;
  line-height: 14px;
  -webkit-font-smoothing: antialiased;
}
.nova_formset .delete-row:before{
  content:"\e082";
}
.nova_formset .add-row:hover, .nova_formset .add-row:focus, .nova_formset .delete-row:hover, .nova_formset .delete-row:focus{
  text-decoration: none;
}
</style>


<br><br><br><br>
<div class="container register-form">
    <div class="form">
        <div class="note text-center">
            <h4>Бараа Нэмэх</h4>
        </div>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-content p-4 border rounded">

                <div class="row">
                    <!-- LEFT COLUMN -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Барааны Нэр</label>
                            {% render_field productForm.name class="form-control" placeholder="Product Name" %}
                        </div>
                        <div class="form-group">
                            <label>Барааны Үнэ (₮)</label>
                            {% render_field productForm.price class="form-control" placeholder="15000" %}
                        </div>
                        <div class="form-group">
                            <label>Тайлбар /Specs/</label>
                            {% render_field productForm.description class="form-control" placeholder="Description" %}
                        </div>
                    </div>

                    <!-- RIGHT COLUMN -->
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Хямдралтай эсэх</label>
                            {% render_field productForm.discount class="form-control" %}
                        </div>
                        <div class="form-group">
                            <label>Барааны Хямдралын Төрөл</label>
                            {% render_field productForm.discount_type class="form-control" placeholder="Шинэ/20%" %}
                        </div>
                        <div class="form-group">
                            <label>Барааны Хямдралтай Үнэ (₮)</label>
                            {% render_field productForm.discount_price class="form-control" placeholder="Заавал биш" %}
                        </div>
                    </div>
                </div>

                <div class="row">
                    {{ formset.management_form }}
                    <!-- IMAGES FORMSET -->
                    <table class="table table-striped table-hover nova_formset" prefix="dtl1">
                        <tbody>
                            {% for form in formset %}
                                <div class="input-group mb-2">
                                    {{ form.image|add_class:"form-control" }}
                                    {% if form.DELETE %}
                                        <div class="input-group-append">
                                            <label class="input-group-text">
                                                <input type="hidden" name="{{ form.DELETE.name }}" id="del-{{ form.prefix }}">
                                                <button type="button" onclick="deleteItem('{{ form.prefix }}')">Устгах</button>
                                            </label>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </tbody>
                      </table>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btnSubmit">Нэмэх</button>
                </div>
            </div>
        </form>
    </div>
</div>


{% block js %}
<script type="text/javascript">

    $('.nova_formset').each(function(){
    var prefix = $(this).attr("prefix")
    $(this).find('tbody tr').formset({'prefix': prefix,
        addText: 'Нэмэх',
        deleteText: '',
        addCssClass: 'add-row icon-plus ' + prefix + "-add-button",
        deleteCssClass: 'delete-row',
        cloneEvent: false,
    });
    });
    function deleteItem(prefix) {
        document.getElementById("del-" + prefix).value = "on";
    }

document.addEventListener("DOMContentLoaded", function () {
    let formsetContainer = document.getElementById("image-formset");
    let addButton = document.getElementById("add-image-btn");
    let totalForms = document.getElementById("id_form-TOTAL_FORMS");

    let emptyFormHtml = `
        <div class="input-group mb-2">
            {{ formset.empty_form.image.as_widget|escapejs }}
        </div>
    `;

    addButton.addEventListener("click", function () {
        let formIndex = totalForms.value;

        let newFormHtml = emptyFormHtml.replace(/__prefix__/g, formIndex);

        formsetContainer.insertAdjacentHTML("beforeend", newFormHtml);

        totalForms.value = parseInt(totalForms.value) + 1;
    });
});
</script>
{% endblock js %}

{% endblock content %}